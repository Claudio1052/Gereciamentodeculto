<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Igreja Verbo da Vida</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --verbo-verde: #2a7221;
        }
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
        }
        .navbar {
            background: linear-gradient(135deg, var(--verbo-verde) 0%, #1a4d14 100%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid var(--verbo-verde);
            font-weight: bold;
        }
        .btn-success {
            background-color: var(--verbo-verde);
            border-color: var(--verbo-verde);
            padding: 10px 25px;
        }
        .btn-success:hover {
            background-color: #1e5c16;
            border-color: #1e5c16;
        }
        .stats-card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .form-control:focus {
            border-color: var(--verbo-verde);
            box-shadow: 0 0 0 0.25rem rgba(42, 114, 33, 0.25);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-house-heart-fill me-2"></i>
                <span style="font-weight: 700;">IGREJA VERBO DA VIDA - ZONA LESTE</span>
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Abas -->
        <ul class="nav nav-tabs mb-4" id="mainTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dashboard">
                    <i class="bi bi-speedometer2 me-1"></i>Dashboard
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#cultos">
                    <i class="bi bi-calendar-event me-1"></i>Cultos
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#membros">
                    <i class="bi bi-person-plus me-1"></i>Membros
                </button>
            </li>
        </ul>

        <!-- Conte√∫do -->
        <div class="tab-content">
            <!-- Dashboard -->
            <div class="tab-pane fade show active" id="dashboard">
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5>Total Membros</h5>
                                <h2 id="total-membros">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5>Cultos</h5>
                                <h2 id="total-cultos">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5>Aniversariantes</h5>
                                <h2 id="total-aniversariantes">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stats-card">
                            <div class="card-body text-center">
                                <h5>M√©dia / Culto</h5>
                                <h2 id="media-pessoas">0</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cultos -->
            <div class="tab-pane fade" id="cultos">
                <h4 class="mb-4">Registrar Novo Culto</h4>
                
                <form id="formCulto">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label>Data do Culto *</label>
                            <input type="date" class="form-control" id="dataCulto" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>In√≠cio *</label>
                            <input type="time" class="form-control" id="inicioCulto" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>T√©rmino *</label>
                            <input type="time" class="form-control" id="terminoCulto" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label>Ministro *</label>
                            <input type="text" class="form-control" id="ministro" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label>Dirigente *</label>
                            <input type="text" class="form-control" id="dirigente" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label>Total Pessoas *</label>
                            <input type="number" class="form-control" id="totalPessoas" required min="1">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label>Homens</label>
                            <input type="number" class="form-control" id="totalHomens" min="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label>Mulheres</label>
                            <input type="number" class="form-control" id="totalMulheres" min="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label>Crian√ßas</label>
                            <input type="number" class="form-control" id="totalCriancas" min="0">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-save me-2"></i>Salvar Culto
                    </button>
                    
                    <div id="msgCulto" class="mt-3"></div>
                </form>
            </div>

            <!-- Membros -->
            <div class="tab-pane fade" id="membros">
                <h4 class="mb-4">Cadastrar Novo Membro</h4>
                
                <form id="formMembro">
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label>Nome Completo *</label>
                            <input type="text" class="form-control" id="nomeMembro" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label>Data Nascimento</label>
                            <input type="date" class="form-control" id="dataNascimento">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label>Telefone</label>
                            <input type="tel" class="form-control" id="telefone">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label>CEP</label>
                            <input type="text" class="form-control" id="cep">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="checkRhema">
                            <label class="form-check-label">Fez Rhema</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="checkMinistros">
                            <label class="form-check-label">Fez Escola de Ministros</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox" id="checkMissoes">
                            <label class="form-check-label">Fez Escola de Miss√µes</label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-person-check me-2"></i>Cadastrar Membro
                    </button>
                    
                    <div id="msgMembro" class="mt-3"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // ============================================
        // üî• CONFIGURA√á√ÉO SUPABASE - SUA URL E CHAVE AQUI!
        // ============================================
        const supabaseUrl = 'https://qfuuykutvuleayldpncp.supabase.co'; // SUA URL DO SUPABASE
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFmdXV5a3V0dnVsZWF5bGRwbmNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczMTMzNTQsImV4cCI6MjA4Mjg4OTM1NH0.V5Fk4ijbaEvUdXtrQyvYoaH4S_WkZjWEsQrxkp3WAdk'; // SUA CHAVE ANON
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // ============================================
        // TESTAR CONEX√ÉO E TABELAS
        // ============================================
        async function testarConexao() {
            console.log('üîÑ Testando conex√£o com Supabase...');
            
            try {
                // Testar tabela membros
                const { data: membros, error: errorMembros } = await supabase
                    .from('membros')
                    .select('count', { count: 'exact', head: true });
                
                if (errorMembros) {
                    console.error('‚ùå ERRO na tabela membros:', errorMembros);
                    alert('ERRO: Tabela "membros" n√£o encontrada!\nExecute o SQL fornecido primeiro.');
                    return false;
                }
                
                // Testar tabela cultos
                const { data: cultos, error: errorCultos } = await supabase
                    .from('cultos')
                    .select('count', { count: 'exact', head: true });
                
                if (errorCultos) {
                    console.error('‚ùå ERRO na tabela cultos:', errorCultos);
                    alert('ERRO: Tabela "cultos" n√£o encontrada!\nExecute o SQL fornecido primeiro.');
                    return false;
                }
                
                console.log('‚úÖ Conex√£o OK! Tabelas existem.');
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro geral:', error);
                alert('Erro de conex√£o com o banco de dados.');
                return false;
            }
        }
        
        // ============================================
        // CADASTRAR CULTO - SIMPLIFICADO E TESTADO
        // ============================================
        document.getElementById('formCulto').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const msgDiv = document.getElementById('msgCulto');
            msgDiv.innerHTML = '<div class="alert alert-info">Salvando...</div>';
            
            // Verificar conex√£o primeiro
            const conexaoOK = await testarConexao();
            if (!conexaoOK) return;
            
            // Coletar dados do formul√°rio
            const dadosCulto = {
                data_culto: document.getElementById('dataCulto').value,
                inicio: document.getElementById('dataCulto').value + 'T' + document.getElementById('inicioCulto').value + ':00',
                termino: document.getElementById('dataCulto').value + 'T' + document.getElementById('terminoCulto').value + ':00',
                ministro: document.getElementById('ministro').value,
                dirigente: document.getElementById('dirigente').value,
                total_pessoas: parseInt(document.getElementById('totalPessoas').value) || 0,
                total_homens: parseInt(document.getElementById('totalHomens').value) || 0,
                total_mulheres: parseInt(document.getElementById('totalMulheres').value) || 0,
                total_criancas: parseInt(document.getElementById('totalCriancas').value) || 0
            };
            
            console.log('üì§ Enviando dados do culto:', dadosCulto);
            
            // Inserir no Supabase
            try {
                const { data, error } = await supabase
                    .from('cultos')
                    .insert([dadosCulto])
                    .select();
                
                if (error) {
                    console.error('‚ùå Erro ao salvar culto:', error);
                    msgDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <strong>Erro ao salvar:</strong> ${error.message}<br>
                            <small>Verifique se a tabela "cultos" existe.</small>
                        </div>
                    `;
                } else {
                    console.log('‚úÖ Culto salvo com sucesso:', data);
                    msgDiv.innerHTML = `
                        <div class="alert alert-success">
                            <strong>Sucesso!</strong> Culto registrado com ID: ${data[0].id}
                        </div>
                    `;
                    
                    // Limpar formul√°rio
                    document.getElementById('formCulto').reset();
                    document.getElementById('dataCulto').valueAsDate = new Date();
                    
                    // Atualizar estat√≠sticas
                    atualizarDashboard();
                }
            } catch (error) {
                console.error('‚ùå Erro de rede:', error);
                msgDiv.innerHTML = '<div class="alert alert-danger">Erro de conex√£o</div>';
            }
        });
        
        // ============================================
        // CADASTRAR MEMBRO - SIMPLIFICADO E TESTADO
        // ============================================
        document.getElementById('formMembro').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const msgDiv = document.getElementById('msgMembro');
            msgDiv.innerHTML = '<div class="alert alert-info">Salvando...</div>';
            
            // Verificar conex√£o
            const conexaoOK = await testarConexao();
            if (!conexaoOK) return;
            
            // Coletar dados
            const dadosMembro = {
                nome: document.getElementById('nomeMembro').value,
                data_nascimento: document.getElementById('dataNascimento').value || null,
                telefone: document.getElementById('telefone').value,
                fez_rhema: document.getElementById('checkRhema').checked,
                fez_escola_ministros: document.getElementById('checkMinistros').checked,
                fez_escola_missoes: document.getElementById('checkMissoes').checked
            };
            
            console.log('üì§ Enviando dados do membro:', dadosMembro);
            
            // Inserir no Supabase
            try {
                const { data, error } = await supabase
                    .from('membros')
                    .insert([dadosMembro])
                    .select();
                
                if (error) {
                    console.error('‚ùå Erro ao salvar membro:', error);
                    msgDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <strong>Erro ao salvar:</strong> ${error.message}<br>
                            <small>Verifique se a tabela "membros" existe.</small>
                        </div>
                    `;
                } else {
                    console.log('‚úÖ Membro salvo com sucesso:', data);
                    msgDiv.innerHTML = `
                        <div class="alert alert-success">
                            <strong>Sucesso!</strong> Membro cadastrado com ID: ${data[0].id}
                        </div>
                    `;
                    
                    // Limpar formul√°rio
                    document.getElementById('formMembro').reset();
                    
                    // Atualizar estat√≠sticas
                    atualizarDashboard();
                }
            } catch (error) {
                console.error('‚ùå Erro de rede:', error);
                msgDiv.innerHTML = '<div class="alert alert-danger">Erro de conex√£o</div>';
            }
        });
        
        // ============================================
        // ATUALIZAR DASHBOARD
        // ============================================
        async function atualizarDashboard() {
            try {
                // Total membros
                const { count: countMembros } = await supabase
                    .from('membros')
                    .select('*', { count: 'exact', head: true });
                document.getElementById('total-membros').textContent = countMembros || 0;
                
                // Total cultos
                const { count: countCultos } = await supabase
                    .from('cultos')
                    .select('*', { count: 'exact', head: true });
                document.getElementById('total-cultos').textContent = countCultos || 0;
                
                console.log('üìä Dashboard atualizado');
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
            }
        }
        
        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Sistema iniciado');
            
            // Configurar data atual
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataCulto').value = hoje;
            
            // Testar conex√£o inicial
            testarConexao().then(sucesso => {
                if (sucesso) {
                    console.log('‚úÖ Sistema pronto para uso!');
                    atualizarDashboard();
                }
            });
        });
    </script>
</body>
</html>
